<script>
    import initI18n from "../utils/initI18n";
    import {stores} from "@sapper/app";
    import {menuOpened, langSwitcherOpened} from '../store';

    const {page} = stores();
    $: lang = $page.params.lang;
    $: path = $page.path;
    $: i18n = initI18n(lang);

    $: pathWithoutLang = $page.path
        .split("/")
        .slice(2)
        .join("/");

    // 1. create a store that can have it's value be set from the 'outside'.
    let current;
    let mainMenu;

    // 2. subscribe to the store to receive updates on value changes.
    menuOpened.subscribe(value => {
        mainMenu = value
    });
    langSwitcherOpened.subscribe(value => {
        current = value
    });

    // toggle the current boolean values, and set the store value which will notify all subscribes of the new value.
    const menuToggle = () => {
        menuOpened.set(false)
        current = !current
        langSwitcherOpened.set(current)
    };

    const langauges = [
        "en", "de", "fr", "it", "sk", "ru", "cz", "bg", "pl", "es", "nl", "ua", "se", "pt", "ja", "zh", "da", "el", "et", "hu", "lt", "lv", "ro", "sl"
    ].sort()
</script>

<div class="md:relative z-50 print:hidden">
    <button class="text-brand-white inline-flex"
            on:click={menuToggle}
            type="button">
        <span class="text-base leading-6 font-bold uppercase">{lang}</span>
        {#if !current}
            <div class="px-1">
                <svg class="text-brand-white h-5 w-5 mt-1"
                     xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                          d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                          clip-rule="evenodd"/>
                </svg>
            </div>
        {:else}
            <div class="px-1">
                <svg class="text-brand-white h-5 w-5 mt-1"
                     xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fillRule="evenodd"
                          d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z"
                          clipRule="evenodd"/>
                </svg>
            </div>
        {/if}
    </button>
    <div class="absolute transform leading-6 -ml-4 inset-x-0 d:max-w-md md:-translate-x-48 { current ? 'block opacity-100 translate-y-0 ease-out' : 'hidden opacity-0 -translate-y-1 ease-in' } transition duration-200">
        <div class="h-screen md:h-full rounded-lg shadow-lg mt-8 md:w-64">
            <div class="relative bg-brand-white ml-3 md:ml-0 p-5 grid grid-cols-2">
                {#each langauges as lang}
                    <a href="{`${lang}/${pathWithoutLang}`}" on:click={menuToggle}
                       class="uppercase inline-block py-3 px-4 text-brand-black rounded-lg font-semibold hover:bg-gray-200 hover:text-gray-700">
                    {lang}</a>
                {/each}
            </div>
            <div class="hidden rounded-b-lg md:block p-8 bg-gray-100">
                <a class="-m-3 p-3 flow-root rounded-md hover:bg-gray-100"
                   href="https://github.com/opendata-stuttgart/meta/wiki/Translations">
                    <div class="items-center">
                        <div class="-ml-2 py-1 rounded-full text-xs font-medium leading-4 bg-brand-greenPastel text-brand-green mb-2 w-1/2 text-center">
                            {i18n.t('nav:langHelpWanted')}
                        </div>
                        <div class="text-base text-xs font-medium text-gray-900">
                            {i18n.t('nav:langCallTo')}
                        </div>
                    </div>
                    <p class="text-sm leading-4 text-gray-500">
                        {i18n.t('nav:langDescription')}
                    </p>
                </a>
            </div>
        </div>
    </div>
</div>



